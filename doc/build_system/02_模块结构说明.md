# 模块依赖关系图

```
┌─────────────────────────────────────────────────────────────┐
│                     build.py (根目录)                        │
│                    [兼容性入口]                              │
└────────────────────────┬────────────────────────────────────┘
                         │ 调用
                         ↓
┌─────────────────────────────────────────────────────────────┐
│                   tool/build.py                              │
│                  [主构建协调器]                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  ProjectBuilder 类                                  │    │
│  │  - 整合所有模块                                    │    │
│  │  - 协调构建流程                                    │    │
│  │  - 管理初次运行/刷新逻辑                          │    │
│  └────────────────────────────────────────────────────┘    │
└─────┬──────┬──────┬──────┬──────────────────────────────────┘
      │      │      │      │
      │      │      │      └─────────────────┐
      ↓      ↓      ↓                        ↓
┌──────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────────────┐
│ project_ │ │ source_  │ │  cmake_  │ │vscode_config_       │
│ config.py│ │scanner.py│ │generator │ │generator.py         │
└──────────┘ └──────────┘ └──────────┘ └─────────────────────┘
     │             │             │              │
     │             │             │              └──────┐
     ↓             ↓             ↓                     ↓
┌─────────┐  ┌──────────┐  ┌──────────┐  ┌─────────────────┐
│Project  │  │Source    │  │CMake     │  │VscodeConfig    │
│Config   │  │Scanner   │  │Generator │  │Generator       │
│         │  │          │  │          │  │                │
│管理配置 │  │扫描文件  │  │生成CMake │  │生成VS Code配置 │
│JSON     │  │解析规则  │  │内容      │  │                │
└─────────┘  └──────────┘  └──────────┘  └─────────────────┘
     │
     ↓
┌─────────────────────────┐
│tool/project_config.json │
│  [自动生成的配置文件]   │
└─────────────────────────┘
```

## 数据流

```
用户运行 build.py
    ↓
ProjectBuilder 初始化
    ↓
├─→ 加载/创建 ProjectConfig
│       ↓
│   读取 project_config.json
│       ↓
├─→ 初始化 SourceScanner
│       ↓
│   扫描源文件和头文件
│   解析子目录CMakeLists
│   查找链接脚本
│       ↓
├─→ 初始化 CMakeGenerator
│       ↓
│   生成 CMakeLists.txt
│   读取 CMake 缓存
│       ↓
├─→ 初始化 VscodeConfigGenerator
│       ↓
│   生成 c_cpp_properties.json
│   生成 launch.json
│   生成 tasks.json
│   生成 settings.json
│       ↓
└─→ 保存 ProjectConfig
        ↓
    写入 project_config.json
```

## 模块职责

| 模块 | 主要类 | 职责 |
|------|--------|------|
| project_config.py | ProjectConfig | 配置文件管理、读写、合并 |
| source_scanner.py | SourceScanner | 文件扫描、目录过滤、规则解析 |
| cmake_generator.py | CMakeGenerator | CMakeLists生成、编译配置 |
| vscode_config_generator.py | VscodeConfigGenerator<br>AdditionalConfigGenerator | VS Code配置生成<br>辅助文件生成 |
| build.py (tool/) | ProjectBuilder | 模块整合、流程协调 |
| build.py (根目录) | - | 兼容性入口 |

## 配置流

```
首次运行:
  扫描项目 → 自动检测配置 → 生成 project_config.json

后续运行:
  读取 project_config.json → 使用配置生成文件

手动刷新:
  重新扫描 → 更新 project_config.json
```
